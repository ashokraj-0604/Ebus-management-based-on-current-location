<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - EBus Management</title>
    <link rel="stylesheet" href="styles/index.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div class="login-container">
        <h2>Admin Login</h2>
        <form id="login-form">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn">Login</button>
        </form>
        <div class="message">
            <p id="error-message" style="color: red;"></p>
        </div>
    </div>
    
    <script>
        const firebaseConfig = {
    apiKey: "AIzaSyAbYTSTs-wth8_qVGvjgThIG-__Ek69NtE",
    authDomain: "ebus-management-9a2ba.firebaseapp.com",
    projectId: "ebus-management-9a2ba",
    storageBucket: "ebus-management-9a2ba.firebasestorage.app",
    messagingSenderId: "1080724320675",
    appId: "1:1080724320675:web:50f4dd697e19a15174aa16",
    measurementId: "G-BWXE2GPSL9"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Login Form Logic
const loginForm = document.getElementById('login-form');
const errorMessage = document.getElementById('error-message');

loginForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;

    // Authenticate user
    auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
            const user = userCredential.user;
            const userId = user.uid; // Get the user ID (UID)

            // Fetch role from Firestore
            db.collection('users').doc(userId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const role = doc.data().role;

                        // Redirect based on role
                        if (role === 'driver') {
                            window.location.href = 'driver.html';
                        } else if (role === 'travel') {
                            window.location.href = 'driver.html';
                        } else if (role === 'admin') {
                            window.location.href = 'admin.html';
                        } else {
                            errorMessage.textContent = "Role not assigned or invalid!";
                        }
                    } else {
                        errorMessage.textContent = "User data not found in Firestore.";
                    }
                })
                .catch((error) => {
                    errorMessage.textContent = `Firestore Error: ${error.message}`;
                });
        })
        .catch(error => {
            errorMessage.textContent = `Authentication Error: ${error.message}`;
        });
});

    </script>
</body>
</html>
